{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user profile within the ConnectVerse application, including personal details, social connections, and gamification attributes.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity."
        },
        "username": {
          "type": "string",
          "description": "Unique username chosen by the user."
        },
        "displayName": {
          "type": "string",
          "description": "The name displayed to other users."
        },
        "profilePictureUrl": {
          "type": "string",
          "description": "URL to the user's avatar image.",
          "format": "uri"
        },
        "bio": {
          "type": "string",
          "description": "A short biographical description provided by the user."
        },
        "statusMessage": {
          "type": "string",
          "description": "A custom status message set by the user."
        },
        "onlineStatus": {
          "type": "string",
          "description": "User's current online presence status (e.g., 'online', 'idle', 'offline', 'do-not-disturb')."
        },
        "lastOnlineAt": {
          "type": "string",
          "description": "Timestamp of the user's last known online activity.",
          "format": "date-time"
        },
        "totalExperiencePoints": {
          "type": "number",
          "description": "Accumulated experience points for the user, contributing to their level and leaderboard ranking."
        },
        "blockedUserIds": {
          "type": "array",
          "description": "References to Users that this user has blocked. (Relationship: User N:N User)",
          "items": {
            "type": "string"
          }
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the user account was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp of the last update to the user's profile.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "username",
        "displayName",
        "onlineStatus",
        "totalExperiencePoints",
        "createdAt"
      ]
    },
    "Friendship": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Friendship",
      "type": "object",
      "description": "Represents a friendship or follow relationship between two users, including its status.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Friendship entity."
        },
        "requesterId": {
          "type": "string",
          "description": "Reference to the User who initiated the friendship request. (Relationship: User 1:N Friendship)"
        },
        "addresseeId": {
          "type": "string",
          "description": "Reference to the User who received the friendship request. (Relationship: User 1:N Friendship)"
        },
        "status": {
          "type": "string",
          "description": "The current status of the friendship request (e.g., 'pending', 'accepted', 'rejected', 'unfriended')."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the friendship request was initiated.",
          "format": "date-time"
        },
        "respondedAt": {
          "type": "string",
          "description": "Timestamp when the friendship request was accepted or rejected.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "requesterId",
        "addresseeId",
        "status",
        "createdAt"
      ]
    },
    "Community": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Community",
      "type": "object",
      "description": "Represents a server or community where users can interact through channels.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Community entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the community."
        },
        "description": {
          "type": "string",
          "description": "Description of the community."
        },
        "ownerId": {
          "type": "string",
          "description": "Reference to the User who owns the community. (Relationship: User 1:N Community)"
        },
        "isPublic": {
          "type": "boolean",
          "description": "Indicates if the community is public or private."
        },
        "communityIconUrl": {
          "type": "string",
          "description": "URL to the community's icon or logo.",
          "format": "uri"
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the community was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "name",
        "ownerId",
        "isPublic",
        "createdAt"
      ]
    },
    "Channel": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Channel",
      "type": "object",
      "description": "Represents a communication channel within a community, used for text, voice, or video.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Channel entity."
        },
        "communityId": {
          "type": "string",
          "description": "Reference to the Community this channel belongs to. (Relationship: Community 1:N Channel)"
        },
        "name": {
          "type": "string",
          "description": "Name of the channel."
        },
        "topic": {
          "type": "string",
          "description": "A brief topic or description for the channel."
        },
        "type": {
          "type": "string",
          "description": "Type of channel (e.g., 'text', 'voice', 'video', 'announcement')."
        },
        "isPrivate": {
          "type": "boolean",
          "description": "Indicates if the channel is private and only accessible to specific roles/members."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the channel was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "communityId",
        "name",
        "type",
        "isPrivate",
        "createdAt"
      ]
    },
    "Role": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Role",
      "type": "object",
      "description": "Defines a set of permissions within a specific community.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Role entity."
        },
        "communityId": {
          "type": "string",
          "description": "Reference to the Community this role belongs to. (Relationship: Community 1:N Role)"
        },
        "name": {
          "type": "string",
          "description": "Name of the role (e.g., 'Admin', 'Moderator', 'Member')."
        },
        "permissions": {
          "type": "array",
          "description": "A list of permission strings granted by this role (e.g., 'sendMessage', 'kickUser', 'manageChannels').",
          "items": {
            "type": "string"
          }
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the role was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "communityId",
        "name",
        "permissions",
        "createdAt"
      ]
    },
    "UserRole": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserRole",
      "type": "object",
      "description": "Junction entity representing a user's assigned role within a specific community.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the UserRole entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to the User. (Relationship: User N:N Role)"
        },
        "roleId": {
          "type": "string",
          "description": "Reference to the Role. (Relationship: User N:N Role)"
        },
        "communityId": {
          "type": "string",
          "description": "Reference to the Community where this role assignment applies. (Relationship: Community 1:N UserRole)"
        },
        "assignedAt": {
          "type": "string",
          "description": "Timestamp when the role was assigned to the user.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "roleId",
        "communityId",
        "assignedAt"
      ]
    },
    "InviteLink": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "InviteLink",
      "type": "object",
      "description": "Represents an invite link for a community, allowing new users to join.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the InviteLink entity."
        },
        "communityId": {
          "type": "string",
          "description": "Reference to the Community this invite link is for. (Relationship: Community 1:N InviteLink)"
        },
        "creatorId": {
          "type": "string",
          "description": "Reference to the User who created this invite link. (Relationship: User 1:N InviteLink)"
        },
        "code": {
          "type": "string",
          "description": "The unique code for the invite link."
        },
        "expiresAt": {
          "type": "string",
          "description": "Timestamp when the invite link will expire.",
          "format": "date-time"
        },
        "maxUses": {
          "type": "number",
          "description": "Maximum number of times this invite link can be used."
        },
        "currentUses": {
          "type": "number",
          "description": "Current number of times this invite link has been used."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the invite link was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "communityId",
        "creatorId",
        "code",
        "maxUses",
        "currentUses",
        "createdAt"
      ]
    },
    "Message": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Message",
      "type": "object",
      "description": "Represents a single message sent in a channel or direct message.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Message entity."
        },
        "channelId": {
          "type": "string",
          "description": "Reference to the Channel where the message was sent. (Relationship: Channel 1:N Message)"
        },
        "senderId": {
          "type": "string",
          "description": "Reference to the User who sent the message. (Relationship: User 1:N Message)"
        },
        "content": {
          "type": "string",
          "description": "The text content of the message, potentially including rich text formatting (e.g., Markdown)."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the message was sent.",
          "format": "date-time"
        },
        "status": {
          "type": "string",
          "description": "Current status of the message (e.g., 'sent', 'delivered', 'read')."
        },
        "readBy": {
          "type": "array",
          "description": "References to Users who have read this message. (Relationship: Message N:N User)",
          "items": {
            "type": "string"
          }
        },
        "editedAt": {
          "type": "string",
          "description": "Timestamp when the message was last edited.",
          "format": "date-time"
        },
        "deletedAt": {
          "type": "string",
          "description": "Timestamp when the message was deleted.",
          "format": "date-time"
        },
        "replyToMessageId": {
          "type": "string",
          "description": "Reference to another Message this message is a reply to, if applicable. (Relationship: Message 1:N Message)"
        },
        "quotedMessageId": {
          "type": "string",
          "description": "Reference to another Message this message is quoting, if applicable. (Relationship: Message 1:N Message)"
        },
        "mediaAttachmentIds": {
          "type": "array",
          "description": "References to MediaAttachment entities associated with this message. (Relationship: Message N:N MediaAttachment)",
          "items": {
            "type": "string"
          }
        },
        "mentionUserIds": {
          "type": "array",
          "description": "References to Users explicitly mentioned in this message. (Relationship: Message N:N User)",
          "items": {
            "type": "string"
          }
        },
        "hashtags": {
          "type": "array",
          "description": "A list of hashtags used in the message content.",
          "items": {
            "type": "string"
          }
        },
        "isPinned": {
          "type": "boolean",
          "description": "Indicates if the message is pinned in the channel."
        }
      },
      "required": [
        "id",
        "channelId",
        "senderId",
        "content",
        "createdAt",
        "status"
      ]
    },
    "MessageReaction": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "MessageReaction",
      "type": "object",
      "description": "Represents a user's reaction (emoji) to a specific message.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the MessageReaction entity."
        },
        "messageId": {
          "type": "string",
          "description": "Reference to the Message being reacted to. (Relationship: Message 1:N MessageReaction)"
        },
        "userId": {
          "type": "string",
          "description": "Reference to the User who added the reaction. (Relationship: User 1:N MessageReaction)"
        },
        "emoji": {
          "type": "string",
          "description": "The emoji character used for the reaction (e.g., 'üëç', '‚ù§Ô∏è')."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the reaction was added.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "messageId",
        "userId",
        "emoji",
        "createdAt"
      ]
    },
    "MediaAttachment": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "MediaAttachment",
      "type": "object",
      "description": "Represents a file or media attached to a message or story.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the MediaAttachment entity."
        },
        "uploaderId": {
          "type": "string",
          "description": "Reference to the User who uploaded the media. (Relationship: User 1:N MediaAttachment)"
        },
        "fileUrl": {
          "type": "string",
          "description": "URL to the stored media file.",
          "format": "uri"
        },
        "thumbnailUrl": {
          "type": "string",
          "description": "URL to a thumbnail image for video or image files.",
          "format": "uri"
        },
        "fileType": {
          "type": "string",
          "description": "Type of media (e.g., 'image', 'video', 'audio', 'document', 'gif')."
        },
        "fileName": {
          "type": "string",
          "description": "Original name of the uploaded file."
        },
        "fileSize": {
          "type": "number",
          "description": "Size of the file in bytes."
        },
        "duration": {
          "type": "number",
          "description": "Duration of the audio/video file in seconds."
        },
        "uploadedAt": {
          "type": "string",
          "description": "Timestamp when the media was uploaded.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "uploaderId",
        "fileUrl",
        "fileType",
        "fileName",
        "fileSize",
        "uploadedAt"
      ]
    },
    "Call": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Call",
      "type": "object",
      "description": "Represents a voice or video call session (1-to-1 or group).",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Call entity."
        },
        "initiatorId": {
          "type": "string",
          "description": "Reference to the User who initiated the call. (Relationship: User 1:N Call)"
        },
        "type": {
          "type": "string",
          "description": "Type of call (e.g., '1-to-1_voice', 'group_video', 'voice_channel')."
        },
        "channelId": {
          "type": "string",
          "description": "Reference to the Channel if this is a voice/video channel call. (Relationship: Channel 1:N Call)"
        },
        "participantIds": {
          "type": "array",
          "description": "References to Users who participated in the call. (Relationship: Call N:N User)",
          "items": {
            "type": "string"
          }
        },
        "startedAt": {
          "type": "string",
          "description": "Timestamp when the call started.",
          "format": "date-time"
        },
        "endedAt": {
          "type": "string",
          "description": "Timestamp when the call ended.",
          "format": "date-time"
        },
        "recordingUrl": {
          "type": "string",
          "description": "URL to the call recording, if enabled.",
          "format": "uri"
        },
        "screenShareEnabled": {
          "type": "boolean",
          "description": "Indicates if screen sharing was active during the call."
        }
      },
      "required": [
        "id",
        "initiatorId",
        "type",
        "participantIds",
        "startedAt"
      ]
    },
    "Story": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Story",
      "type": "object",
      "description": "Represents a disappearing story or status update posted by a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Story entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to the User who posted the story. (Relationship: User 1:N Story)"
        },
        "mediaUrl": {
          "type": "string",
          "description": "URL to the image or video content of the story.",
          "format": "uri"
        },
        "caption": {
          "type": "string",
          "description": "Optional text caption for the story."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the story was created.",
          "format": "date-time"
        },
        "expiresAt": {
          "type": "string",
          "description": "Timestamp when the story will automatically disappear (e.g., 24 hours after creation).",
          "format": "date-time"
        },
        "viewedBy": {
          "type": "array",
          "description": "References to Users who have viewed this story. (Relationship: Story N:N User)",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "userId",
        "mediaUrl",
        "createdAt",
        "expiresAt"
      ]
    },
    "Notification": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Notification",
      "type": "object",
      "description": "Represents a notification sent to a user, alerting them of an event.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Notification entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to the User who is the recipient of the notification. (Relationship: User 1:N Notification)"
        },
        "type": {
          "type": "string",
          "description": "Type of notification (e.g., 'message', 'mention', 'call', 'friendRequest', 'communityInvite', 'storyUpdate')."
        },
        "sourceEntityId": {
          "type": "string",
          "description": "ID of the entity that triggered the notification (e.g., messageId, callId, friendshipId, communityId)."
        },
        "sourceEntityType": {
          "type": "string",
          "description": "Type of the entity that triggered the notification (e.g., 'Message', 'Call', 'Friendship', 'Community')."
        },
        "message": {
          "type": "string",
          "description": "The human-readable message content of the notification."
        },
        "isRead": {
          "type": "boolean",
          "description": "Indicates if the notification has been read by the user."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the notification was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "type",
        "sourceEntityId",
        "sourceEntityType",
        "message",
        "isRead",
        "createdAt"
      ]
    },
    "Report": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Report",
      "type": "object",
      "description": "Represents a user-submitted report against content or another user for moderation.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Report entity."
        },
        "reporterId": {
          "type": "string",
          "description": "Reference to the User who submitted the report. (Relationship: User 1:N Report)"
        },
        "reportedEntityId": {
          "type": "string",
          "description": "ID of the entity being reported (e.g., messageId, userId, communityId)."
        },
        "reportedEntityType": {
          "type": "string",
          "description": "Type of the entity being reported (e.g., 'Message', 'User', 'Community', 'Channel')."
        },
        "reason": {
          "type": "string",
          "description": "Text describing the reason for the report."
        },
        "status": {
          "type": "string",
          "description": "Current status of the report (e.g., 'pending', 'reviewed', 'resolved', 'rejected')."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the report was submitted.",
          "format": "date-time"
        },
        "resolvedByAdminId": {
          "type": "string",
          "description": "Reference to the Admin User who resolved the report, if applicable. (Relationship: User 1:N Report)"
        },
        "resolvedAt": {
          "type": "string",
          "description": "Timestamp when the report was resolved.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "reporterId",
        "reportedEntityId",
        "reportedEntityType",
        "reason",
        "status",
        "createdAt"
      ]
    },
    "ExperiencePointActivity": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ExperiencePointActivity",
      "type": "object",
      "description": "Records individual instances of a user gaining experience points, serving as an XP history.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the ExperiencePointActivity entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to the User who gained the experience points. (Relationship: User 1:N ExperiencePointActivity)"
        },
        "activityType": {
          "type": "string",
          "description": "The type of action that granted the XP (e.g., 'sendMessage', 'participateInCall', 'reactToMessage', 'createChannel', 'storyPosted')."
        },
        "pointsGained": {
          "type": "number",
          "description": "The amount of experience points gained in this activity."
        },
        "relatedEntityId": {
          "type": "string",
          "description": "Optional: ID of the entity related to the activity (e.g., messageId, callId, channelId)."
        },
        "relatedEntityType": {
          "type": "string",
          "description": "Optional: Type of the entity related to the activity (e.g., 'Message', 'Call', 'Channel')."
        },
        "timestamp": {
          "type": "string",
          "description": "Timestamp when the experience points were gained, recorded down to the second.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "activityType",
        "pointsGained",
        "timestamp"
      ]
    },
    "Achievement": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Achievement",
      "type": "object",
      "description": "Defines an achievement that users can unlock, often associated with an XP reward and special recognition.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Achievement entity."
        },
        "name": {
          "type": "string",
          "description": "The name of the achievement (e.g., 'Chat Master', 'Community Founder')."
        },
        "description": {
          "type": "string",
          "description": "A description of how to unlock the achievement and what it signifies."
        },
        "iconUrl": {
          "type": "string",
          "description": "URL to an icon or badge image representing the achievement.",
          "format": "uri"
        },
        "xpReward": {
          "type": "number",
          "description": "The amount of experience points awarded upon unlocking this achievement."
        },
        "unlockCondition": {
          "type": "string",
          "description": "A programmatic or descriptive condition for unlocking the achievement (e.g., 'Send 1000 messages', 'Host 10 group calls')."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the achievement was defined.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "name",
        "description",
        "xpReward",
        "unlockCondition",
        "createdAt"
      ]
    },
    "UserAchievement": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserAchievement",
      "type": "object",
      "description": "Junction entity recording when a specific user has unlocked an achievement.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the UserAchievement entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to the User who unlocked the achievement. (Relationship: User N:N Achievement)"
        },
        "achievementId": {
          "type": "string",
          "description": "Reference to the Achievement that was unlocked. (Relationship: User N:N Achievement)"
        },
        "unlockedAt": {
          "type": "string",
          "description": "Timestamp when the user unlocked the achievement.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "achievementId",
        "unlockedAt"
      ]
    },
    "AIContextToolSuggestion": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "AIContextToolSuggestion",
      "type": "object",
      "description": "Records an AI-generated tool suggestion provided to a user based on conversation context.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the AIContextToolSuggestion entity."
        },
        "messageId": {
          "type": "string",
          "description": "Reference to the Message that triggered the AI suggestion. (Relationship: Message 1:N AIContextToolSuggestion)"
        },
        "userId": {
          "type": "string",
          "description": "Reference to the User for whom the AI suggestion was generated. (Relationship: User 1:N AIContextToolSuggestion)"
        },
        "suggestionType": {
          "type": "string",
          "description": "The category or type of the suggestion (e.g., 'summarize', 'elaborate', 'knowledgeRetrieval', 'action')."
        },
        "suggestedToolName": {
          "type": "string",
          "description": "The name of the suggested tool or action (e.g., 'Summarize Response', 'Elaborate on Details')."
        },
        "suggestedParameters": {
          "type": "string",
          "description": "JSON string of parameters for the suggested tool, if any. Example: '{ \"messageCount\": 5, \"summarizeType\": \"key_points\" }'."
        },
        "displayContext": {
          "type": "string",
          "description": "Contextual information for displaying the suggestion (e.g., 'sidepanel', 'inline')."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the AI suggestion was generated.",
          "format": "date-time"
        },
        "actionTaken": {
          "type": "boolean",
          "description": "Indicates if the user took action based on this suggestion."
        },
        "actionTakenAt": {
          "type": "string",
          "description": "Timestamp when the user took action on the suggestion.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "messageId",
        "userId",
        "suggestionType",
        "suggestedToolName",
        "createdAt",
        "actionTaken"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Root collection for user profiles. The document ID corresponds to the Firebase Authentication UID. Contains denormalized 'totalExperiencePoints' for leaderboard ranking. Some fields are publicly readable (displayName, profilePictureUrl), while others are private (blockedUserIds)."
        }
      },
      {
        "path": "/users/{userId}/notifications/{notificationId}",
        "definition": {
          "entityName": "Notification",
          "schema": {
            "$ref": "#/backend/entities/Notification"
          },
          "description": "Private notifications for a specific user. Authorization is strictly path-based: only the user matching '{userId}' can read/write their notifications."
        }
      },
      {
        "path": "/users/{userId}/stories/{storyId}",
        "definition": {
          "entityName": "Story",
          "schema": {
            "$ref": "#/backend/entities/Story"
          },
          "description": "Disappearing stories posted by a user. Includes denormalized 'userId' (owner) and 'viewableByFriendIds' map for authorization, allowing friends to list and view stories without needing to query parent data or other collections for each story. 'expiresAt' handles visibility duration."
        }
      },
      {
        "path": "/users/{userId}/xp_history/{xpActivityId}",
        "definition": {
          "entityName": "ExperiencePointActivity",
          "schema": {
            "$ref": "#/backend/entities/ExperiencePointActivity"
          },
          "description": "Records individual instances of a user gaining experience points, providing a detailed, timestamped history for XP boards. Authorization is path-based to the owning user."
        }
      },
      {
        "path": "/users/{userId}/achievements/{userAchievementId}",
        "definition": {
          "entityName": "UserAchievement",
          "schema": {
            "$ref": "#/backend/entities/UserAchievement"
          },
          "description": "Records when a specific user has unlocked an achievement. Authorization is path-based to the owning user. Links to global achievement definitions."
        }
      },
      {
        "path": "/users/{userId}/ai_suggestions/{suggestionId}",
        "definition": {
          "entityName": "AIContextToolSuggestion",
          "schema": {
            "$ref": "#/backend/entities/AIContextToolSuggestion"
          },
          "description": "Stores AI-generated tool suggestions specific to a user's conversation context. Authorization is strictly path-based to the owning user."
        }
      },
      {
        "path": "/friendships/{friendshipId}",
        "definition": {
          "entityName": "Friendship",
          "schema": {
            "$ref": "#/backend/entities/Friendship"
          },
          "description": "Represents a friendship or follow relationship between two users. Documents include 'requesterId' and 'addresseeId' for authorization checks by either participating user. Supports efficient querying for a user's friendships by either ID."
        }
      },
      {
        "path": "/communities/{communityId}",
        "definition": {
          "entityName": "Community",
          "schema": {
            "$ref": "#/backend/entities/Community"
          },
          "description": "Main community document. Includes 'ownerId' for primary control and 'isPublic' for general visibility. Crucially, includes denormalized 'memberRoles: { [userId]: string[] }' mapping user IDs to an array of their role IDs within the community, enabling atomic authorization checks for members and administrators."
        }
      },
      {
        "path": "/communities/{communityId}/channels/{channelId}",
        "definition": {
          "entityName": "Channel",
          "schema": {
            "$ref": "#/backend/entities/Channel"
          },
          "description": "Communication channels within a community. Includes denormalized 'communityOwnerId', 'communityIsPublic', and 'communityMemberRoles' from the parent community for authorization independence. If 'isPrivate', also includes 'allowedMemberIds: { [userId]: true }' for explicit channel access control."
        }
      },
      {
        "path": "/communities/{communityId}/roles/{roleId}",
        "definition": {
          "entityName": "Role",
          "schema": {
            "$ref": "#/backend/entities/Role"
          },
          "description": "Defines custom roles and their permissions within a specific community. Access is controlled by the denormalized 'communityOwnerId' or appropriate 'communityMemberRoles' permissions inherited from the parent community document."
        }
      },
      {
        "path": "/communities/{communityId}/user_roles/{userRoleId}",
        "definition": {
          "entityName": "UserRole",
          "schema": {
            "$ref": "#/backend/entities/UserRole"
          },
          "description": "Junction entity assigning a user a specific role(s) within a community. This acts as the source of truth for the 'memberRoles' denormalized field on the parent Community document."
        }
      },
      {
        "path": "/communities/{communityId}/invite_links/{inviteId}",
        "definition": {
          "entityName": "InviteLink",
          "schema": {
            "$ref": "#/backend/entities/InviteLink"
          },
          "description": "Invite links for joining a community. Includes denormalized 'communityOwnerId' and 'communityMemberRoles' to authorize link creation and management without 'get()' operations on the parent community."
        }
      },
      {
        "path": "/communities/{communityId}/channels/{channelId}/messages/{messageId}",
        "definition": {
          "entityName": "Message",
          "schema": {
            "$ref": "#/backend/entities/Message"
          },
          "description": "Individual messages sent within a channel. Includes denormalized 'communityOwnerId', 'communityMemberRoles', 'channelIsPrivate', and 'channelAllowedMemberIds' (if private) from parent Community and Channel documents for authorization independence. 'senderId' identifies the message author."
        }
      },
      {
        "path": "/communities/{communityId}/channels/{channelId}/messages/{messageId}/reactions/{reactionId}",
        "definition": {
          "entityName": "MessageReaction",
          "schema": {
            "$ref": "#/backend/entities/MessageReaction"
          },
          "description": "User reactions to a specific message. Includes denormalized authorization context from parent Message, Channel, and Community documents ('communityOwnerId', 'communityMemberRoles', 'channelIsPrivate', 'channelAllowedMemberIds') to ensure authorization independence."
        }
      },
      {
        "path": "/media_attachments/{mediaId}",
        "definition": {
          "entityName": "MediaAttachment",
          "schema": {
            "$ref": "#/backend/entities/MediaAttachment"
          },
          "description": "Metadata for all uploaded media files. 'uploaderId' ensures the uploader can manage their media. Read access to media data is controlled primarily by Firebase Storage rules, with Firestore rules potentially referencing parent message/story documents via app logic."
        }
      },
      {
        "path": "/calls/{callId}",
        "definition": {
          "entityName": "Call",
          "schema": {
            "$ref": "#/backend/entities/Call"
          },
          "description": "Records details of voice and video call sessions. 'initiatorId' and 'participantIds' are key for authorization, ensuring only call participants can access call details."
        }
      },
      {
        "path": "/reports/{reportId}",
        "definition": {
          "entityName": "Report",
          "schema": {
            "$ref": "#/backend/entities/Report"
          },
          "description": "User-submitted reports for moderation. 'reporterId' allows reporters to view their own reports. Access for moderation is restricted to designated administrators (e.g., via a separate '/app_admins' collection or a global admin list)."
        }
      },
      {
        "path": "/achievements/{achievementId}",
        "definition": {
          "entityName": "Achievement",
          "schema": {
            "$ref": "#/backend/entities/Achievement"
          },
          "description": "Global definitions of achievements. Publicly readable for all authenticated users to discover achievements, with write access restricted to administrative users."
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to be highly secure, scalable, and debuggable, strictly adhering to the core design principles. Authorization Independence is achieved through strategic denormalization. For collaborative data like Communities and Channels, critical authorization context such as 'ownerId', 'isPublic', and 'memberRoles' is denormalized directly into child documents (Channels, Messages, MessageReactions, InviteLinks). This eliminates the need for expensive and rule-breaking 'get()' operations on parent documents, allowing security rules to evaluate access atomically based on the document itself. For user-specific data (e.g., Notifications, Stories, XP History, Achievements, AI Suggestions), a path-based ownership model (`/users/{userId}/...`) is employed, ensuring that only the owner can access their private data. The 'Friendship' collection allows users to query their own friendships efficiently using query predicates (`requesterId` or `addresseeId`). Stories, which are shared with friends, denormalize a `viewableByFriendIds` map to support QAPs (Queryable Access Patterns), ensuring friends can list relevant stories without complex server-side filtering or violating authorization independence. Global entities like 'Achievements' and 'MediaAttachments' have simplified access models appropriate for their purpose. The 'ExperiencePointActivity' collection under `/users/{userId}/xp_history` provides a detailed, timestamped record of XP gains, enabling advanced XP board features and user-specific history views, while the 'totalExperiencePoints' on the 'User' document facilitates efficient global leaderboard ranking. Structural segregation is maintained by using distinct collections for data with different security postures, such as private user data versus community-shared content. All wildcards are descriptive, and fields like 'status' are used for explicit state modeling, enhancing data clarity and predictability for easier rule management and debugging."
  }
}